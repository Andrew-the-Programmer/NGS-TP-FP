# NGS-TP-FP

Скрипт, определяющий погрешность результата NGS.

# Параметры

`Coverage depth (COV)`: число прочтений.

`Variant reads (VR)`: число вариантных прочтений.

`Variant allele frequency (VAF)`: частота вариационных прочтений (`VAF = VR / COV`).

`Minimum variant reads (MVR)`: минимальное число вариантных прочтений, чтобы считать, что человек болен.

`Sequence error (ERR)`: процент ошибок при чтении - вероятность того, что прибор прочитает не действительный нуклеотид, а любой другой.

# Пример

Прибор сделал `1000` прочтений: `COV = 1000`.
Показания прибора: `A = 96%`, `G = 3%`, `C = 1%`, `T = 0%`.
Вы хотите исследовать `G` на мутацию, тогда `VAF = 3%`, `VR = COV * VAF = 30`.
Вы считаете, что если у человека больше `10` вариантных прочтений, то он болен: `MVR = 10`.
Прибор показывает, что человек болен (т.к. `VR >= MVR`), но вам бы хотелось узнать, какова вероятность того, что на самом деле у человека `VR < MVR` (в таком случае мы считаем, что он не болен).
Такое возможно, так как прибор может совершать ошибки при чтении (`ERR`).
Эта ошибка должна определяться вами. Как я понял, она в интервале `0.1% - 1%`.

# Результат

`FP - false positive` - неверно положительный результат: вероятность того, что человек не болен при положительном результате.

`TP - true positive` - верно положительный результат: вероятность того, что человек действительно болен при положительном результате.

# Работа программы

1. `python app.py`
2. Введите параметры
3. Нажмите `Enter` или кнопку `Compute` чтобы увидеть результат (или ошибку).

# Замечания и возможные ошибки

1. Программа допускает ввод `VAF` или `VR`. Введен должен быть ровно один параметр.
2. Должно выполняться неравенство `VAF >= ERR`, иначе ошибка слишком велика.
3. Должно выполняться неравенство `0 < MVR <= VR <= COV`.

# Математика

Данная программа не дает точный результат ошибок, а пытается их достаточно хорошо оценить.
Количество ошибок - случайная величина, имеющая биномальное распределение `Bi(n, p)`.

Пусть `FP, TP` - действительные значения, а `fp, tp` - оценки, полученные программой.
Пусть аналогично `VR` - действительное значение, а `vr` - параметр, поданный программе на вход.

Утверждения:

1. $FP = P(VR < mvr), FP = P(VR \ge mvr)$
2. $FP = \sum_{VR = 0}^{mvr - 1}\sum_{l=0}^{VR}{Q(cov, VR) \cdot P(Bi(VR, err) = l) \cdot P(Bi(cov - VR, err^\star) = vr - k + l}$

$err$ - веростность ошибки: $G \to \{A, C, T\}$
$err^\star$ - веростность ошибки: $\{A, C, T\} \to G$
Если все ошибки равновероятны: $err^\star = err / 3$
$Q(cov, VR)$ - вероятность того, что в действительности вариантных прочтений из $cov$ будет $VR$.
Эта вероятность нам не известна, поэтому оценим ее $1$.

$FP \le \sum_{VR = 0}^{mvr - 1}\sum_{l=0}^{VR}{P(Bi(VR, err) = l) \cdot P(Bi(cov - VR, err^\star) = vr - k + l} = fp$

$tp = 1 - fp$
$FP \le fp \implies -FP \ge -fp \implies 1 - FP \ge 1 - fp \implies TP \ge tp$

Получили желаемое: верхнюю оценку на $FP$ и нижнюю оценку на $TP$.

